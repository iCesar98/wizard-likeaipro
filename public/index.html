<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Like AI PRO Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

<div class="bg-white w-full max-w-md h-[700px] shadow-2xl rounded-2xl flex flex-col">

  <!-- Header -->
  <div class="bg-black text-white p-4 rounded-t-2xl">
    ü§ñ Like AI PRO
  </div>

  <!-- Chat -->
  <div id="chat" class="flex-1 p-4 overflow-y-auto space-y-3"></div>

  <!-- Options -->
  <div id="options" class="p-4 border-t space-y-2"></div>

</div>

<script>
let state = {
  business_type: null,
  volume: null,
  problem: null,
  goal: null,
  estimated_loss: 0
};

const chat = document.getElementById("chat");
const optionsDiv = document.getElementById("options");

function addBot(text) {
  const div = document.createElement("div");
  div.className = "bg-gray-200 p-3 rounded-lg";
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addUser(text) {
  const div = document.createElement("div");
  div.className = "bg-black text-white p-3 rounded-lg ml-auto";
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function setOptions(options) {
  optionsDiv.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.className = "w-full bg-gray-100 hover:bg-gray-200 p-2 rounded-lg";
    btn.innerText = opt.label;
    btn.onclick = () => {
      addUser(opt.label);
      optionsDiv.innerHTML = "";
      opt.action();
    };
    optionsDiv.appendChild(btn);
  });
}

function startFlow() {
  addBot("Hola üëã soy Like AI PRO.\n¬øQu√© tipo de negocio tienes?");
  setOptions([
    { label: "Gym üí™", action: () => selectBusiness("gym") },
    { label: "Cl√≠nica Est√©tica ‚ú®", action: () => selectBusiness("estetica") },
    { label: "Restaurante üçΩ", action: () => selectBusiness("restaurante") },
    { label: "Otro", action: () => selectBusiness("otro") }
  ]);
}

function selectBusiness(type) {
  state.business_type = type;

  if (type === "gym") {
    addBot("¬øCu√°ntos prospectos recibes al mes?");
    setOptions([
      { label: "0-50", action: () => selectVolume(50) },
      { label: "50-200", action: () => selectVolume(200) },
      { label: "200+", action: () => selectVolume(400) }
    ]);
  }

  if (type === "estetica") {
    addBot("¬øOfreces m√°s servicios?");
    setOptions([
      { label: "Faciales", action: nextGoal },
      { label: "Corporales", action: nextGoal },
      { label: "Ambos", action: nextGoal }
    ]);
  }

  if (type === "restaurante") {
    addBot("¬øTu mayor problema es?");
    setOptions([
      { label: "Reservas", action: nextGoal },
      { label: "Delivery", action: nextGoal },
      { label: "Repetici√≥n clientes", action: nextGoal }
    ]);
  }

  if (type === "otro") {
    nextGoal();
  }
}

function selectVolume(vol) {
  state.volume = vol;
  state.estimated_loss = vol * 0.25;
  nextGoal();
}

function nextGoal() {
  addBot("Si Like AI PRO trabajara 24/7 para ti,\n¬øtu objetivo principal ser√≠a?");
  setOptions([
    { label: "Generar m√°s citas", action: () => finishFlow("citas") },
    { label: "Cerrar m√°s ventas", action: () => finishFlow("ventas") },
    { label: "Automatizar atenci√≥n", action: () => finishFlow("automatizacion") }
  ]);
}

function finishFlow(goal) {
  state.goal = goal;

  let revenueImpact = Math.floor(state.estimated_loss * 30);

  addBot(
    "Basado en lo que me dijiste...\n\n" +
    "Podr√≠as estar perdiendo aproximadamente " +
    state.estimated_loss +
    " prospectos al mes.\n\n" +
    "Eso podr√≠a representar hasta $" +
    revenueImpact.toLocaleString() +
    " en ingresos no capturados."
  );

  setOptions([
    { label: "Activar mi sistema üöÄ", action: sendToServer },
    { label: "Hablar con asesor", action: () => alert("Aqu√≠ conectamos Calendly") }
  ]);
}

async function sendToServer() {
  addBot("Creando tu configuraci√≥n...");

  const response = await fetch("/create-bot", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      business_type: state.business_type,
      bot_objective: state.goal,
      business_name: state.business_type,
      user_email: "demo@likeaipro.com",
      whatsapp_number: "N/A",
      tone: "profesional"
    })
  });

  const data = await response.json();

  if (data.success) {
    addBot("‚úÖ Tu bot fue creado correctamente.");
  } else {
    addBot("‚ùå Hubo un problema al crear tu bot.");
  }
}

startFlow();
</script>

</body>
</html>